<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>sm_predict • sjosmooth</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="sm_predict">
<meta property="og:description" content="">
<meta property="og:image" content="http://www.danieldsjoberg.com/sjosmooth/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sjosmooth</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/TheoryMethods.html">Methods</a>
    </li>
    <li>
      <a href="../articles/sm_predict.html">sm_predict()</a>
    </li>
    <li>
      <a href="../articles/sm_regression.html">sm_regression()</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ddsjoberg/sjosmooth">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="sm_predict_files/htmlwidgets-1.3/htmlwidgets.js"></script><script src="sm_predict_files/plotly-binding-4.8.0.9000/plotly.js"></script><script src="sm_predict_files/typedarray-0.1/typedarray.min.js"></script><script src="sm_predict_files/jquery-1.11.3/jquery.min.js"></script><link href="sm_predict_files/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet">
<script src="sm_predict_files/crosstalk-1.0.0/js/crosstalk.min.js"></script><link href="sm_predict_files/plotly-htmlwidgets-css-1.40.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="sm_predict_files/plotly-main-1.40.1/plotly-latest.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>sm_predict</h1>
                        <h4 class="author">Daniel D. Sjoberg</h4>
            
            <h4 class="date">2018-12-02</h4>
      
      
      <div class="hidden name"><code>sm_predict.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The <code><a href="../reference/sm_predict.html">sm_predict()</a></code> function calculates kernel-smoothed predictions from regression models (i.e. outputs from the <code>predict()</code> function). The following examples focus on time-to-event endpoints. The example data set is simulated from a Cox regression model.</p>
<p><span class="math display">\[
h(t) = h_0(t)e^{\textbf{X}\beta}
\]</span></p>
<p>with <span class="math inline">\(h_0(t) = 1\)</span> and <span class="math inline">\(\textbf{X}\beta = 0.02 * age - 0.2 * marker\)</span>. The independent variables age and marker are independent from one another. The example data set containts the following columns:</p>
<pre><code>time    Years from cancer treatment to death
age     Age at treatment
marker  Marker level at treatment
survt1  True 1 year survival probability</code></pre>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(sjosmooth)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># loading data from sjosmooth github page</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">load</span>(<span class="kw">url</span>(<span class="st">"https://github.com/ddsjoberg/sjosmooth/blob/master/examples/cancertx.rda?raw=true"</span>))</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">cancertx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(time, age, marker, survt1) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>() <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">time</th>
<th align="right">age</th>
<th align="right">marker</th>
<th align="right">survt1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">4.396865</td>
<td align="right">12.79050</td>
<td align="right">10.052925</td>
<td align="right">0.8411829</td>
</tr>
<tr class="even">
<td align="right">1.761713</td>
<td align="right">32.70496</td>
<td align="right">8.164047</td>
<td align="right">0.6867428</td>
</tr>
<tr class="odd">
<td align="right">4.401422</td>
<td align="right">23.16842</td>
<td align="right">8.725925</td>
<td align="right">0.7576508</td>
</tr>
<tr class="even">
<td align="right">1.027328</td>
<td align="right">30.00945</td>
<td align="right">12.923154</td>
<td align="right">0.8715716</td>
</tr>
<tr class="odd">
<td align="right">1.979813</td>
<td align="right">31.51574</td>
<td align="right">9.909102</td>
<td align="right">0.7719386</td>
</tr>
<tr class="even">
<td align="right">2.009533</td>
<td align="right">38.03416</td>
<td align="right">7.372298</td>
<td align="right">0.6127544</td>
</tr>
</tbody>
</table>
<p>The simualted data contains 10,000 observations.</p>
</div>
<div id="example-1---univariate" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1---univariate" class="anchor"></a>Example 1 - Univariate</h2>
<p>Kernel smoothing can be computationally intense on large data sets. The following code was run to get the example object <code>sm_regression_ex1</code> and the results saved to <a href="https://github.com/ddsjoberg/sjosmooth/tree/master/examples">GitHub</a>.</p>
<pre><code>library(survival)
library(sjosmooth)
sm_predict_ex1 =
  sm_predict(
    data = cancertx,
    method = "coxph",
    formula = Surv(time) ~ marker,
    newdata = dplyr::data_frame(marker = seq(5, 15, 0.5), time = 1),
    type = "survival",
    verbose = TRUE
  )</code></pre>
<p>The data in the <code>cancertx</code> data frame was simulated from a Cox regression model with linear predictor.</p>
<p><span class="math display">\[
\textbf{X}\beta = 0.02 * age - 0.2 * marker
\]</span></p>
<p>In the model age and marker level are independent, and therefore, the univariate model the slope coefficient for marker remains <span class="math inline">\(\beta_{marker} = -0.2\)</span></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co"># loading data and example results from sjosmooth github page</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">load</span>(<span class="kw">url</span>(<span class="st">"https://github.com/ddsjoberg/sjosmooth/blob/master/examples/sm_predict_ex1.rda?raw=true"</span>))</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">ggplot</span>(sm_predict_ex1, <span class="kw">aes</span>(<span class="dt">x =</span> marker, <span class="dt">y =</span> .fitted)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> .fitted.ll, <span class="dt">ymax =</span> .fitted.ul), <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_line</span>(</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">    <span class="dt">data =</span> cancertx <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(marker <span class="op">&gt;=</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>marker <span class="op">&lt;=</span><span class="st"> </span><span class="dv">15</span>),</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">    <span class="kw">aes</span>(<span class="dt">x =</span> marker, <span class="dt">y =</span> survt1_marker),</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">    <span class="dt">linetype =</span> <span class="st">"dashed"</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">    <span class="dt">y =</span> <span class="st">"1 year survival probability"</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">  )</a></code></pre></div>
<p><img src="sm_predict_files/figure-html/remedy001-1.png" width="700"></p>
<p>The dashed line is the true one year survival, and the solid line is the estimated survival from <code><a href="../reference/sm_predict.html">sm_predict()</a></code>.</p>
</div>
<div id="example-2---multivariable" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2---multivariable" class="anchor"></a>Example 2 - Multivariable</h2>
<p>In this example, the 1 year survival will be estimated by both age and marker level. The following code was run in advance, and the results saved to <a href="https://github.com/ddsjoberg/sjosmooth/tree/master/examples">GitHub</a>.</p>
<pre><code>sm_predict_ex2 &lt;-
  sjosmooth::sm_predict(
    data = cancertx,
    method = "coxph",
    formula = Surv(time) ~ marker + age,
    newdata =
      list(
        marker = seq(7, 13, 1),
        age = seq(20, 40, 2)
      ) %&gt;%
        purrr::cross_df() %&gt;%
        dplyr::mutate(time = 1),
    type = "survival",
    verbose = TRUE
  )</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">library</span>(plotly)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; Attaching package: 'plotly'</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; The following object is masked from 'package:ggplot2':</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt;     last_plot</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; The following object is masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt;     filter</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; The following object is masked from 'package:graphics':</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt;     layout</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co"># loading example results</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="kw">load</span>(<span class="kw">url</span>(<span class="st">"https://github.com/ddsjoberg/sjosmooth/blob/master/examples/sm_predict_ex2.rda?raw=true"</span>))</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co"># adding true risk to dataset, and calculating difference between estiamted and true rate</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17">sm_predict_ex2 =<span class="st"> </span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="st">  </span>sm_predict_ex2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb6-20" data-line-number="20">    <span class="dt">survt1 =</span> <span class="kw">exp</span>(<span class="op">-</span><span class="kw">exp</span>((<span class="dv">1</span><span class="op">/</span><span class="dv">50</span>) <span class="op">*</span><span class="st"> </span>age <span class="op">-</span><span class="st"> </span><span class="fl">0.2</span> <span class="op">*</span><span class="st"> </span>marker)),</a>
<a class="sourceLine" id="cb6-21" data-line-number="21">    <span class="dt">surv_diff =</span> survt1 <span class="op">-</span><span class="st"> </span>.fitted</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">  )</a>
<a class="sourceLine" id="cb6-23" data-line-number="23"></a>
<a class="sourceLine" id="cb6-24" data-line-number="24"><span class="co"># plot histogram of differences between fitted and true</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25">sm_predict_ex2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> surv_diff)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">    <span class="dt">title =</span> <span class="st">"Difference Distribution"</span>,</a>
<a class="sourceLine" id="cb6-30" data-line-number="30">    <span class="dt">x =</span> <span class="st">"Difference in estimated and true survival"</span></a>
<a class="sourceLine" id="cb6-31" data-line-number="31">  )</a></code></pre></div>
<p><img src="sm_predict_files/figure-html/remedy002-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co"># extracting unique values of independent variables</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">age.seq =</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span>sm_predict_ex2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(age) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">  </span><span class="kw">arrange</span>(age) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">  </span><span class="kw">pull</span>()</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">marker.seq =</a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="st">  </span>sm_predict_ex2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="st">  </span><span class="kw">select</span>(marker) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="st">  </span><span class="kw">arrange</span>(marker) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="st">  </span><span class="kw">pull</span>()</a>
<a class="sourceLine" id="cb7-16" data-line-number="16"></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co"># Plotting the true survival probabilities</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18">sm_predict_ex2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="st">  </span><span class="kw">select</span>(marker, age, survt1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(age, survt1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>marker) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">z =</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.matrix</span>(.),</a>
<a class="sourceLine" id="cb7-23" data-line-number="23">          <span class="dt">x =</span> marker.seq,</a>
<a class="sourceLine" id="cb7-24" data-line-number="24">          <span class="dt">y =</span> age.seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="st">  </span><span class="kw">add_surface</span>(<span class="dt">showscale=</span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="st">  </span><span class="kw">layout</span>(</a>
<a class="sourceLine" id="cb7-27" data-line-number="27">    <span class="dt">title =</span> <span class="st">"True Risk of Death within 1 Year"</span>,</a>
<a class="sourceLine" id="cb7-28" data-line-number="28">    <span class="dt">scene =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb7-29" data-line-number="29">      <span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">"Marker"</span>),</a>
<a class="sourceLine" id="cb7-30" data-line-number="30">      <span class="dt">yaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">"Age"</span>),</a>
<a class="sourceLine" id="cb7-31" data-line-number="31">      <span class="dt">zaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">"Survival Prob."</span>)</a>
<a class="sourceLine" id="cb7-32" data-line-number="32">    ))</a></code></pre></div>
<div id="htmlwidget-cc465156c410c75fe709" style="width:700px;height:432.632880098888px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-cc465156c410c75fe709">{"x":{"visdat":{"357462ac5fe3":["function () ","plotlyVisDat"]},"cur_data":"357462ac5fe3","attrs":{"357462ac5fe3":{"z":{},"x":[7,8,9,10,11,12,13],"y":[20,22,24,26,28,30,32,34,36,38,40],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface","showscale":false,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"True Risk of Death within 1 Year","scene":{"xaxis":{"title":"Marker"},"yaxis":{"title":"Age"},"zaxis":{"title":"Survival Prob."}},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"colorbar":{"title":"as.matrix(.)","ticklen":2},"colorscale":[["0","rgba(68,1,84,1)"],["0.122708244578632","rgba(71,44,122,1)"],["0.202220288265625","rgba(65,68,134,1)"],["0.260955157513266","rgba(59,85,139,1)"],["0.317267972361227","rgba(52,100,141,1)"],["0.360857736311767","rgba(47,110,142,1)"],["0.392536009911255","rgba(45,118,142,1)"],["0.453470549158017","rgba(38,132,142,1)"],["0.492227157933846","rgba(37,142,140,1)"],["0.525053240739471","rgba(35,150,138,1)"],["0.565809654125053","rgba(34,160,136,1)"],["0.613115157568129","rgba(45,171,129,1)"],["0.641994233209397","rgba(50,177,125,1)"],["0.669775951804946","rgba(55,184,120,1)"],["0.711597603275101","rgba(81,192,109,1)"],["0.743957286784377","rgba(95,198,100,1)"],["0.768156264302661","rgba(105,203,92,1)"],["0.794784033605035","rgba(122,208,84,1)"],["0.832513287720084","rgba(147,213,70,1)"],["0.850463814875461","rgba(158,216,63,1)"],["0.873420500902249","rgba(171,220,53,1)"],["0.900838896765042","rgba(188,223,43,1)"],["0.926623549056816","rgba(206,225,42,1)"],["0.958093363505766","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"z":[[0.692200627555346,0.681885934921354,0.671313497933194,0.660483648427271,0.649397334792741,0.638056166582019,0.626462459763781,0.614619282348499,0.602530500076141,0.590200821812905,0.577635844258916],[0.739934054783606,0.730894479250428,0.721603258472026,0.712058273835347,0.702257816815645,0.692200627555346,0.681885934921354,0.671313497933194,0.660483648427271,0.649397334792741,0.638056166582019],[0.781455584849563,0.773630602588598,0.765569481401734,0.757268574526507,0.748724476755579,0.739934054783606,0.730894479250428,0.721603258472026,0.712058273835347,0.702257816815645,0.692200627555346],[0.817179486939029,0.810473956302311,0.803553198966916,0.796412757162531,0.789048287846897,0.781455584849563,0.773630602588597,0.765569481401734,0.757268574526507,0.748724476755579,0.739934054783606],[0.847640316515773,0.841941399611202,0.836050594567173,0.829963150604252,0.823674342757472,0.817179486939029,0.810473956302311,0.803553198966916,0.796412757162531,0.789048287846897,0.781455584849563],[0.873423018493117,0.868612280319187,0.863633351331116,0.858481536342661,0.853152108052597,0.847640316515773,0.841941399611202,0.836050594567173,0.829963150604252,0.823674342757472,0.817179486939029],[0.895114927477049,0.89107638912607,0.88689238518758,0.882558492252263,0.878070220391308,0.873423018493117,0.868612280319187,0.863633351331116,0.858481536342661,0.853152108052597,0.847640316515773]],"x":[7,8,9,10,11,12,13],"y":[20,22,24,26,28,30,32,34,36,38,40],"type":"surface","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script><div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co"># Plotting the estimated survival probabilities from sm_predict()</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">sm_predict_ex2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(marker, age, .fitted) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(age, .fitted) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>marker) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">z =</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.matrix</span>(.),</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">          <span class="dt">x =</span> marker.seq,</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">          <span class="dt">y =</span> age.seq) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="st">  </span><span class="kw">add_surface</span>(<span class="dt">showscale=</span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="st">  </span><span class="kw">layout</span>(</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">    <span class="dt">title =</span> <span class="st">"Estimated Risk of Death within 1 Year"</span>,</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">    <span class="dt">scene =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">      <span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">"Marker"</span>),</a>
<a class="sourceLine" id="cb8-15" data-line-number="15">      <span class="dt">yaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">"Age"</span>),</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">      <span class="dt">zaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">"Survival Prob."</span>)</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">    ))</a></code></pre></div>
<div id="htmlwidget-24f2c7f44d5cfe5936ea" style="width:700px;height:432.632880098888px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-24f2c7f44d5cfe5936ea">{"x":{"visdat":{"357414004f28":["function () ","plotlyVisDat"]},"cur_data":"357414004f28","attrs":{"357414004f28":{"z":{},"x":[7,8,9,10,11,12,13],"y":[20,22,24,26,28,30,32,34,36,38,40],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface","showscale":false,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Estimated Risk of Death within 1 Year","scene":{"xaxis":{"title":"Marker"},"yaxis":{"title":"Age"},"zaxis":{"title":"Survival Prob."}},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"colorbar":{"title":"as.matrix(.)","ticklen":2},"colorscale":[["0","rgba(68,1,84,1)"],["0.176216713040743","rgba(67,61,130,1)"],["0.243091428247703","rgba(61,80,138,1)"],["0.30996085044246","rgba(53,98,141,1)"],["0.373492355279648","rgba(47,113,142,1)"],["0.40839181340997","rgba(43,122,142,1)"],["0.437157202798933","rgba(39,128,142,1)"],["0.486685453182022","rgba(37,141,140,1)"],["0.532912662111298","rgba(34,152,138,1)"],["0.568276752990954","rgba(35,161,135,1)"],["0.608041398561891","rgba(44,170,130,1)"],["0.640206880205079","rgba(49,177,125,1)"],["0.685187070717241","rgba(66,187,116,1)"],["0.711281597941864","rgba(80,192,109,1)"],["0.7388010236899","rgba(93,197,101,1)"],["0.770453035721341","rgba(106,204,91,1)"],["0.786849646968535","rgba(116,206,86,1)"],["0.806425163417948","rgba(130,209,80,1)"],["0.824403118617491","rgba(142,212,73,1)"],["0.848865992442123","rgba(157,216,64,1)"],["0.860227986390719","rgba(164,218,59,1)"],["0.884825843187641","rgba(178,221,46,1)"],["0.909363559808497","rgba(194,224,43,1)"],["0.92963012883743","rgba(208,226,42,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"z":[[0.691858169323692,0.680367840557495,0.670778909319993,0.658889988273919,0.643019509982294,0.630496437281888,0.618918787597061,0.602270020368487,0.581986196815007,0.56053031943489,0.53842120303552],[0.735312455863696,0.723459980864412,0.71522161782378,0.708347065291778,0.69779030282799,0.688690816293989,0.676481717536726,0.661121895294744,0.643949754177021,0.62531492676315,0.604624256381888],[0.780010783266469,0.77192963384491,0.766326258679534,0.760120952583836,0.752062940197133,0.741502101695121,0.731391836098287,0.718969209373466,0.704706432931899,0.692550809159131,0.677784019926521],[0.824835194861385,0.818573849707245,0.811523245147282,0.80490480084459,0.797688491411762,0.788835942376652,0.780153778551712,0.771233798163186,0.760020539860617,0.749638357859194,0.741543576314333],[0.847840140596366,0.841249598107099,0.833809372407997,0.828530371317352,0.825492557015436,0.820396407376697,0.813435313349276,0.80587377605528,0.797904597641124,0.791832124175125,0.788211543788229],[0.870712119940202,0.863808102294075,0.85845483526933,0.854833898809238,0.850619182000506,0.848091196592364,0.84458540700654,0.838963850026067,0.833185739648868,0.827010556336268,0.820017995463216],[0.902979075517312,0.892326129043265,0.884709716704969,0.877906880635837,0.874416706817625,0.87119161529246,0.868386303254921,0.863528024620499,0.857018917067075,0.848148714103556,0.837767193308997]],"x":[7,8,9,10,11,12,13],"y":[20,22,24,26,28,30,32,34,36,38,40],"type":"surface","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#example-1---univariate">Example 1 - Univariate</a></li>
      <li><a href="#example-2---multivariable">Example 2 - Multivariable</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel D. Sjoberg.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
